name: Update arXiv Papers

on:
  schedule:
    - cron: '0 0 * * *'
  workflow_dispatch:

jobs:
  update-papers:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v2

      - name: Set up Python
        uses: actions/setup-python@v2
        with:
          python-version: '3.x'

      - name: Install dependencies
        run: |
          pip install arxiv
          pip install pyyaml

      - name: Fetch and update papers
        run: |
          python <<EOF
          import arxiv
          import yaml

          client = arxiv.Client()

          search = arxiv.Search(
            query="cat:cs.AI OR cat:cs.LG OR cat:cs.CL",
            max_results=10,
            sort_by=arxiv.SortCriterion.SubmittedDate
          )

          papers_data = []
          for result in client.results(search):
              paper_data = {
                  'title': result.title,
                  'authors': [author.name for author in result.authors],
                  'summary': result.summary,
                  'url': result.pdf_url,
                  'published': result.published.strftime('%Y-%m-%d')
              }
              papers_data.append(paper_data)

          with open('_data/papers.yml', 'w') as f:
              yaml.dump(papers_data, f)
          EOF

      - name: Commit and push changes
        uses: stefanzweifel/git-auto-commit-action@v4
        with:
          commit_message: "Update arXiv papers"
          branch: main
          file_pattern: _data/papers.yml
          commit_user_name: Zeural
          commit_user_email: zeural@example.com
          commit_author: Zeural <zeural@example.com>
